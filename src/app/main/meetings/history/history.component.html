<div
  class="p-sm-16 pb-0"
  fxLayout="row"
  style="background-color: rgb(244, 244, 244) !important;
  min-height: 100vh !important;"
>
  <div fxLayout="row" fxLayoutAlign="space-around" fxFlex>
    <!-- Weeks -->
    <fuse-sidebar
      class="sidebar"
      name="history-sidebar"
      position="left"
      lockedOpen="gt-sm"
    >
      <div class="content" fusePerfectScrollbar>
        <div class="sidebar-content">
          <div class="card">
            <div
              class="header p-16"
              fxLayout="row"
              fxLayoutAlign="start center"
            >
              <span class="h3">Affichage par semaine</span>
            </div>
            <div class="content p-16" fusePerfectScrollbar>
              <div class="nav material2">
                <div class="nav-item" *ngFor="let week of latestWeeks">
                  <a
                    class="nav-link"
                    matRipple
                    [ngClass]="{
                      'active accent': currentWeek?.id == week?.id
                    }"
                    (click)="currentWeek = week; findTaskItems()"
                  >
                    <span>{{ "Semaine " + week.weekNumber }}</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </fuse-sidebar>

    <!-- Task items -->
    <div fxLayout="column" fxFlex>
      <div
        class="header p-8"
        fxLayout.gt-md="row"
        fxLayout.lt-md="column"
        fxLayoutAlign="space-between center"
      >
        <div fxLayoutAlign="space-between center" class="pl-4">
          <button
            mat-icon-button
            class="sidebar-toggle mr-12"
            fxHide.gt-sm
            (click)="commonService.toggleSidebar('history-sidebar')"
          >
            <mat-icon>menu</mat-icon>
          </button>
          <!-- <h3 class="m-0">
            <span [matBadge]="taskItems.length" matBadgeOverlap="false"
              >Total</span
            >
          </h3> -->
          <button class="m-8" mat-raised-button>
            {{ "Total: " + taskItems.length }}
          </button>
        </div>
        <div
          fxLayoutAlign="space-between center"
          class="search-wrapper mt-16 mt-md-0 pl-4"
        >
          <div class="search" fxFlex fxLayout="row" fxLayoutAlign="end center">
            <button mat-icon-button class="secondary-text">
              <mat-icon>search</mat-icon>
            </button>
            <input
              placeholder="Filtrer par mot clé"
              name="search"
              [(ngModel)]="filterInput"
              (keyup.enter)="currentWeek = null; findTaskItems()"
            />
          </div>
        </div>
      </div>
      <div class="ml-16 mr-16">
        <div
          class="fuse-card mb-8"
          *ngFor="let taskItem of taskItems; index as i"
        >
          <div class="p-16" fxLayout="row">
            <div class="h2 pr-16">{{ taskItem.folderName }}</div>
          </div>
          <div class="card-divider full-width"></div>
          <div class="p-16" fxLayout="row">
            <div fxLayout="row wrap" fxLayoutAlign="start" class="content-text">
              <div
                class="h4"
                [outerHTML]="taskItem.content | replaceLineBreaks"
              ></div>
            </div>
          </div>
          <div class="card-divider full-width"></div>
          <div
            fxLayout="row"
            fxLayoutAlign="space-between center"
            class="deadline-text"
          >
            <div fxLayout="row" fxLayoutAlign="start center">
              {{ taskItem.date | date: "dd/MM/yyyy hh:mm" }}
            </div>
            <div fxLayout="row" fxLayoutAlign="end center">
              {{ taskItem.sectorName }}
            </div>
          </div>
          <mat-accordion>
            <mat-expansion-panel (opened)="getCommentsTaskItem(taskItem, i)">
              <mat-expansion-panel-header
                style="background-color: #f4f4f4 !important"
              >
                <mat-panel-title>
                  <mat-panel-description>
                    <mat-icon>comment</mat-icon> Afficher les commentaires
                  </mat-panel-description>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div *ngIf="taskItem.comments.length > 0">
                <div
                  fxLayout="row"
                  fxLayout.lt-md="column"
                  *ngFor="let comment of taskItem.comments"
                  class="px-4 py-16"
                >
                  <div fxLayout="column" fxFlex="20%">
                    <div fxLayout="row" fxLayoutAlign="start">
                      <span>{{ comment.ownerName }}</span>
                    </div>
                    <div fxLayout="row" fxLayoutAlign="start">
                      <div class="time">
                        {{ comment.date }}
                      </div>
                    </div>
                  </div>
                  <div fxLayout="row" fxLayoutAlign="start" fxFlex="80%">
                    <div
                      class="comment-panel"
                      fxLayout="row"
                      fxLayoutAlign="start"
                    >
                      <span>{{ comment.content }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="h2"
                fxLayoutAlign="center center"
                *ngIf="taskItem.comments.length == 0"
              >
                Aucune commentaire associé
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>
    </div>
  </div>
</div>
