<div class="dialog-content-wrapper">
  <mat-toolbar class="mat-accent m-0">
    <mat-toolbar-row fxFlex fxLayout="row" fxLayoutAlign="space-between center">
      <span class="title dialog-title"
        >{{ data.mode == "edit" ? "Modifier un site" : "Ajouter un site" }}
      </span>
      <button
        mat-icon-button
        (click)="matDialogRef.close()"
        aria-label="Close dialog"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-toolbar-row>
  </mat-toolbar>

  <div mat-dialog-content class="p-24 m-0" fusePerfectScrollbar>
    <ng-template #addForm>
      <form
        #f="ngForm"
        (ngSubmit)="onSubmit(f)"
        name="composeForm"
        class="compose-form"
        fxLayout="column"
        fxFlex
      >
        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input
            #name="ngModel"
            [(ngModel)]="site.name"
            placeholder="Nom de site"
            matInput
            name="name"
            required
            minlength="3"
          />
          <mat-error *ngIf="name.invalid && (name.dirty || name.touched)">
            Veuillez renseigner le nom (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Adresse</mat-label>
          <input
            #address="ngModel"
            [(ngModel)]="site.address"
            placeholder="Adresse de site"
            matInput
            name="address"
            required
            minlength="3"
          />
          <mat-error
            *ngIf="address.invalid && (address.dirty || address.touched)"
          >
            Veuillez renseigner l'adresse (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Ville</mat-label>
          <input
            #city="ngModel"
            [(ngModel)]="site.city"
            placeholder="Ville de site"
            matInput
            name="city"
            required
            minlength="3"
          />
          <mat-error *ngIf="city.invalid && (city.dirty || city.touched)">
            Veuillez renseigner la ville (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Code postal</mat-label>
          <input
            #zipCode="ngModel"
            [(ngModel)]="site.zipCode"
            placeholder="Code postal"
            matInput
            name="zipCode"
            required
            minlength="3"
          />
          <mat-error
            *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched)"
          >
            Veuillez renseigner le code postal (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Pays</mat-label>
          <input
            [(ngModel)]="site.country"
            placeholder="Pays"
            matInput
            name="country"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Les coordonnées GPS</mat-label>
          <input
            [value]="'Lat. :' + site.latitude + 'Lon. :' + this.site.longitude"
            placeholder="Les coordonnées GPS"
            matInput
            name="siteCoordonate"
            readonly
            required
          />
          <button
            fxShow.gt-sm
            fxHide
            style="bottom: 10px;"
            type="button"
            mat-raised-button
            matPrefix
            (click)="getCoordinateFromAddress()"
          >
            Obtenir
          </button>
          <button
            fxShow.lt-md
            fxHide
            mat-icon-button
            type="button"
            matPrefix
            (click)="getCoordinateFromAddress()"
          >
            <mat-icon>location_on</mat-icon>
          </button>
          <button
            fxShow.gt-sm
            fxHide
            style="bottom: 10px;"
            type="button"
            mat-raised-button
            matSuffix
            (click)="openGoogleMaps()"
          >
            Géolocaliser
          </button>
          <button
            fxShow.lt-md
            fxHide
            mat-icon-button
            type="button"
            matSuffix
            (click)="openGoogleMaps()"
          >
            <mat-icon>gps_fixed</mat-icon>
          </button>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Téléphone</mat-label>
          <input
            [(ngModel)]="site.phone"
            placeholder="Téléphone"
            matInput
            name="phone"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Fax</mat-label>
          <input [(ngModel)]="site.fax" placeholder="Fax" matInput name="fax" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Numéro d'agrément</mat-label>
          <input
            [(ngModel)]="site.agreementNumber"
            placeholder="Numéro d'agrément"
            matInput
            name="agreementNumber"
            readonly
            required
          />
          <button
            fxShow.gt-sm
            fxHide
            style="bottom: 10px;"
            type="button"
            mat-raised-button
            matSuffix
            [disabled]="zipCode.invalid"
            (click)="generateAgreementNumber()"
          >
            Générer N°
          </button>
          <button
            fxShow.lt-md
            fxHide
            mat-icon-button
            type="button"
            matSuffix
            [disabled]="zipCode.invalid"
            (click)="generateAgreementNumber()"
          >
            <mat-icon>autorenew</mat-icon>
          </button>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Contact</mat-label>
          <input
            [(ngModel)]="site.contact"
            placeholder="Contact"
            matInput
            name="contact"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input
            [(ngModel)]="site.email"
            placeholder="Email"
            matInput
            name="email"
          />
        </mat-form-field>
        <mat-checkbox
          [(ngModel)]="site.displayInTheWebSite"
          name="displayInTheWebSite"
          class="pb-20"
          >Afficher sur le site
        </mat-checkbox>
        <mat-form-field appearance="outline">
          <mat-label>Raison Social</mat-label>
          <input
            [(ngModel)]="site.companyName"
            placeholder="Raison Social"
            matInput
            name="companyName"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Site internet</mat-label>
          <input
            [(ngModel)]="site.webSite"
            placeholder="Site internet"
            matInput
            name="webSite"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Estampille vétérinaire</mat-label>
          <input
            [(ngModel)]="site.veterinaryStamp"
            placeholder="Estampille vétérinaire"
            matInput
            name="veterinaryStamp"
          />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Remarques</mat-label>
          <input
            [(ngModel)]="site.comment"
            placeholder="Remarques"
            matInput
            name="comment"
          />
        </mat-form-field>
        <mat-form-field appearance="outline" *ngIf="data.mode === 'new'">
          <mat-label>Séletionner une zone</mat-label>
          <mat-select name="departments" [(ngModel)]="site.department" required>
            <mat-option
              *ngFor="let department of departments"
              [value]="department"
            >
              {{ department.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" *ngIf="data.mode === 'new'">
          <mat-label>Types du partenaire</mat-label>
          <mat-select
            name="siteTypes"
            [(ngModel)]="site.siteTypes"
            multiple
            required
          >
            <mat-option *ngFor="let siteType of siteTypes" [value]="siteType">
              {{ siteType.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div
          mat-dialog-actions
          class="m-0 p-16"
          fxLayout="row"
          fxLayoutAlign="end end"
        >
          <button mat-raised-button color="accent" type="submit">
            {{ data.mode == "edit" ? "Modifier" : "Créer" }}
            <mat-icon>check</mat-icon>
          </button>
        </div>
      </form>
    </ng-template>
    <ng-template #completeRestaurant>
      <mat-tab-group mat-align-tabs="center" mat-stretch-tabs>
        <mat-tab label="Site">
          <div class="tab-content mt-8">
            <ng-container *ngTemplateOutlet="addForm"></ng-container>
          </div>
        </mat-tab>

        <mat-tab label="Restaurant">
          <div class="tab-content mt-8">
            <form
              #f2="ngForm"
              (ngSubmit)="updateRestaurantInformation(f2)"
              name="restaurantForm"
              class="compose-form"
              fxLayout="column"
              fxFlex
            >
              <mat-form-field appearance="outline">
                <mat-label>Horaires d'ouverture</mat-label>
                <input
                  [(ngModel)]="site.openingTime"
                  placeholder="Horaires d'ouverture"
                  matInput
                  name="openingTime"
                />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Jours de fermeture</mat-label>
                <input
                  [(ngModel)]="site.closingDays"
                  placeholder="Jours de fermeture"
                  matInput
                  name="closingDays"
                />
              </mat-form-field>
              <mat-checkbox
                [(ngModel)]="site.isBookingPrefered"
                name="isBookingPrefered"
                >Réservation conseillée ?
              </mat-checkbox>
              <mat-form-field appearance="outline">
                <mat-label>Nombre de places</mat-label>
                <input
                  [(ngModel)]="site.numberOfSeats"
                  placeholder="Nombre de places"
                  matInput
                  type="number"
                  name="numberOfSeats"
                />
              </mat-form-field>
              <custom-chip-list
                [labelTitle]="'Types de restaurants'"
                [allItems]="restaurantTypes"
                [selectedItems]="site.restaurantTypes"
              ></custom-chip-list>
              <custom-chip-list
                [labelTitle]="'Options'"
                [allItems]="restaurantOptions"
                [selectedItems]="site.restaurantOptions"
              ></custom-chip-list>
              <custom-chip-list
                [labelTitle]="'Spécialités'"
                [allItems]="restaurantSpecialies"
                [selectedItems]="site.restaurantSpecialies"
              ></custom-chip-list>
              <div
                mat-dialog-actions
                class="m-0 p-16"
                fxLayout="row"
                fxLayoutAlign="end end"
              >
                <button mat-raised-button color="accent" type="submit">
                  Mettre à jour
                  <mat-icon>check</mat-icon>
                </button>
              </div>
            </form>
          </div>
        </mat-tab>
      </mat-tab-group>
    </ng-template>
    <ng-container
      *ngIf="
        data.mode == 'new' ||
          (data.mode == 'edit' && !showRestaurantExtra(site));
        else completeRestaurant
      "
    >
      <ng-container *ngTemplateOutlet="addForm"> </ng-container>
    </ng-container>
  </div>
</div>
