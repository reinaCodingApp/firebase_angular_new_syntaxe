<div class="flex flex-col w-full">
  <!-- HEADER -->
  <div class="bg-red-700 text-white p-6 flex flex-row items-center">
    <button matTooltip="Retour à la liste des utilisateurs" mat-icon-button [routerLink]="'/settings'">
      <mat-icon class="text-white">arrow_back</mat-icon>
    </button>
    <h1 class="text-xl">
      Table des droits d'accès
    </h1>
  </div>
  <!-- / HEADER -->
 <div class="m-4 p-2 border-2 border-gray-50  mat-card">
    <div class="p-4 mb-8 border-b-2 flex flex-col sm:flex-row items-start sm:items-center justify-between">
      <div>
        <div class="text-xl" *ngIf="currentUser && currentUser.displayName">
          {{ currentUser.displayName }}
        </div>
        <div class="text-md" *ngIf="currentUser && currentUser.email">
          {{ currentUser.email }}
        </div>
      </div>
      <div>
        <div class="flex flex-col sm:flex-row items-start sm:items-center  mt-3 sm:mt-0">
          <mat-checkbox class="mr-3 p-1" (change)="selectPermissions($event.checked)" name="selectPermissions">
            Sélectionner tout
          </mat-checkbox>
          <div class=" mt-1 sm:mt-0">
            <button mat-raised-button color="accent" (click)="clonePermissions()" class="mr-2">
              Cloner
              <mat-icon class="ml-1">supervisor_account</mat-icon>
            </button>
            <button mat-raised-button color="primary" (click)="updateUserClaims()">
              Enregistrer
              <mat-icon class="ml-1">save</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div> 
    <mat-table  #table [dataSource]="filteredModules">
      <!-- Title Column -->
      <ng-container matColumnDef="a">
        <mat-header-cell *matHeaderCellDef class="text-sm">Modules</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-icon-button [satPopoverAnchor]="popover" (click)="popover.toggle()">
            <mat-icon class="mr-1">info</mat-icon>
          </button>
          <div class="hidden sm:block">{{ m.title }}</div>

          <sat-popover #popover hasBackdrop horizontalAlign="after" verticalAlign="center" forceAlignment lockAlignment>
            <div class="bg-white shadow-2xl border-2 p-4 max-w-100  text-md">
              <h2 class="mt-0 hidden sm:block">{{ m.title }}</h2>
              <div [outerHTML]="m.aclDescription"></div>
            </div>
          </sat-popover>

        </mat-cell>
      </ng-container>

      <!-- Get  -->
      <ng-container matColumnDef="get">
        <mat-header-cell *matHeaderCellDef class="text-sm">Get</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 1)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 1">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 1">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- List -->
      <ng-container matColumnDef="list">
        <mat-header-cell *matHeaderCellDef class="text-sm">List</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 2)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 2">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 2">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- Create -->
      <ng-container matColumnDef="create">
        <mat-header-cell *matHeaderCellDef class="text-sm">Create</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 3)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 3">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 3">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- Edit -->
      <ng-container matColumnDef="edit">
        <mat-header-cell *matHeaderCellDef class="text-sm">Edit</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 4)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 4">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 4">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- Delete -->
      <ng-container matColumnDef="delete">
        <mat-header-cell *matHeaderCellDef class="text-sm">Delete</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 5)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 5">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 5">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- Admin -->
      <ng-container matColumnDef="admin">
        <mat-header-cell *matHeaderCellDef class="text-sm">Admin</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 6)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 6">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 6">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- SuperAdmin -->
      <ng-container matColumnDef="superAdmin">
        <mat-header-cell *matHeaderCellDef class="text-sm">Super Admin</mat-header-cell>
        <mat-cell *matCellDef="let m">
          <button mat-flat-button class="text-white" (click)="updategrantedAccess(m, 7)">
            <mat-icon class="bg-green-700 text-white" *ngIf="m.grantedAccess >= 7">check</mat-icon>
            <mat-icon class="text-white bg-red-700 p-1" *ngIf="m.grantedAccess < 7">close</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
      <mat-row *matRowDef="let m; columns: displayColumns"> </mat-row>
    </mat-table>
  </div>
</div>