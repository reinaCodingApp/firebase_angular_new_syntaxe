<div class="flex flex-col max-w-240 md:min-w-160 max-h-screen -m-6">
  <!-- Header -->
  <div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
    <div class="text-lg font-medium">{{
      data.mode == "new" ? "Créer ordre mission" : "Modifier ordre mission"


      }}</div>
    <button mat-icon-button (click)="matDialogRef.close()" [tabIndex]="-1">
      <mat-icon class="text-white" [svgIcon]="'heroicons_outline:x'"></mat-icon>
    </button>
  </div>
  <!-- / Header -->
  <form #f="ngForm" name="composeForm" class="flex flex-col flex-auto p-6 overflow-y-auto">
    <!-- Stepper Horizontal -->
    <mat-horizontal-stepper *ngIf="!smallScreen" labelPosition="bottom" [linear]="true">
      <!-- Mission infos -->
      <mat-step label="Mission infos" ngModelGroup="generalInfo" #generalInfo="ngModelGroup"
        [stepControl]="generalInfo">
        <div class="flex flex-col">
          <mat-form-field appearance="outline">
            <mat-label>Objet de la mission</mat-label>
            <input #title="ngModel" [(ngModel)]="newMissionOrder.title" placeholder="Objet de la mission" matInput
              name="title" required minlength="3" />
            <mat-error *ngIf="title.invalid && (title.dirty || title.touched)">
              Veuillez renseigner le titre (3 caractères minimum) !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Début de la mission</mat-label>
            <input #start="ngModel" matInput [matDatepicker]="startPicker" placeholder="Début de la mission"
              [(ngModel)]="newMissionOrder.missionStart" name="startPicker" required />
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            <mat-error *ngIf="start.invalid && (start.dirty || start.touched)">
              Veuillez renseigner la date de début de la mission !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Fin de la mission</mat-label>
            <input #end="ngModel" matInput [matDatepicker]="endPicker" placeholder="Début de la mission"
              [(ngModel)]="newMissionOrder.missionEnd" name="endPicker" required [min]="newMissionOrder.missionStart" />
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
            <mat-error *ngIf="end.invalid && (end.dirty || end.touched)">
              Veuillez renseigner la date de fin de la mission !
            </mat-error>
          </mat-form-field>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button matStepperNext color="accent">
              Suivant
            </button>
          </div>
        </div>
      </mat-step>
      <!-- Clients -->
    

      <mat-step label="Clients" [optional]="data.mode == 'edit'">
        <div class="mt-4">
          <div  >
            <div  >
              <mat-form-field appearance="outline">
                <mat-label>Client</mat-label>
                <input
                  #client="ngModel"
                  matInput
                  [(ngModel)]="clientName"
                  placeholder="Ajouter un client"
                  name="client"
                />
              </mat-form-field>
              <button
                type="button"
                color="accent"
                mat-icon-button
                aria-label="add client"
                (click)="addClient()"
              >
                <mat-icon>check</mat-icon>
              </button>
            </div>
            <div *ngIf="newMissionOrder.clients.length != 0"  >
              <mat-form-field appearance="outline"  class="pr-4">
                <mat-label>Site</mat-label>
                <input
                  matInput
                  [(ngModel)]="siteName"
                  placeholder="Ajouter un site"
                  name="site"
                />
              </mat-form-field>
              <mat-form-field appearance="outline"  class="pl-4">
                <mat-label>Clients</mat-label>
                <mat-select name="clients" [(ngModel)]="clientIndex">
                  <mat-option
                    *ngFor="
                      let client of newMissionOrder.clients;
                      index as clientIndex
                    "
                    [value]="clientIndex"
                  >
                    {{ client.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <button
                type="button"
                mat-icon-button
                color="accent"
                aria-label="add site"
                (click)="addSite(clientIndex)"
              >
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <div
              *ngIf="newMissionOrder.clients.length != 0"
       
            >
              <div class="details">
                <table width="100%" class="border-b-2 border-gray-100 shadow-lg bg-white border-separate">

                  <thead>
                    <tr>
                      <th class="border-t-2 border-l-2 border-gray-100">Client</th>
                      <th class="border-t-2 border-l-2 border-gray-100">Sites</th>
                    </tr>
                  </thead>
                  <tbody
                    *ngFor="
                      let client of newMissionOrder.clients;
                      index as clientIndex
                    "
                  >
                    <tr>
                      <td class="border-t-2 border-l-2 border-gray-100">
                        {{ client.name }}
                        <button
                          color="warn"
                          mat-icon-button
                          aria-label="remove client"
                          (click)="removeClient(clientIndex)"
                        >
                          <mat-icon>close</mat-icon>
                        </button>
                      </td>
                      <td class="border-t-2 border-l-2 border-gray-100">
                        <p
                          *ngFor="
                            let site of client.sites;
                            index as siteIndex
                          "
                        >
                          {{ site.name }}
                          <button
                            color="warn"
                            mat-icon-button
                            aria-label="remove site"
                            (click)="removeSite(clientIndex, siteIndex)"
                          >
                            <mat-icon>close</mat-icon>
                          </button>
                        </p>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div
          mat-dialog-actions
      
        >
          <button mat-raised-button matStepperPrevious color="accent">
            Précédent
          </button>
          <button mat-raised-button matStepperNext color="accent">
            Suivant
          </button>
        </div>
      </mat-step>
      <!-- Intervenants -->
      <mat-step label="Intervenants" [optional]="true">
        <div>
          <div class="flex flex-row w-full justify-between">
            <mat-form-field appearance="outline" class="w-1/4  ">
              <mat-label>Choisir un salarié</mat-label>
              <mat-select name="employee" [(ngModel)]="missionOrderEmployee.employee">
                <mat-option>
                  <ngx-mat-select-search ngModel name="searchINput" (ngModelChange)="searchEmployee($event)"
                    placeholderLabel="Rechercher" noEntriesFoundLabel="pas de resultats"></ngx-mat-select-search>
                </mat-option>
                <mat-option *ngFor="let employee of filtredEmployees" [value]="employee">
                  {{ employee.fullName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-1/4  mx-1">
              <mat-label>Nombre de jours facturés</mat-label>
              <mat-select name="days" [(ngModel)]="missionOrderEmployee.daysWork">
                <mat-option *ngFor="let day of dayWorks" [value]="day.day">
                  {{ day.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-1/4 ">
              <mat-label>Date de départ</mat-label>
              <input matInput [matDatepicker]="missionOrderEmployeeStartPicker" placeholder="Début de la mission"
                [(ngModel)]="missionOrderEmployee.start" name="missionOrderEmployeeStartPicker"
                [min]="newMissionOrder.missionStart" />
              <mat-datepicker-toggle matSuffix [for]="missionOrderEmployeeStartPicker"></mat-datepicker-toggle>
              <mat-datepicker #missionOrderEmployeeStartPicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field appearance="outline" class="w-1/4  mx-1">
              <mat-label>Date de fin</mat-label>
              <input matInput [matDatepicker]="missionOrderEmployeeEndPicker" placeholder="Début de la mission"
                [(ngModel)]="missionOrderEmployee.end" name="missionOrderEmployeeEndPicker"
                [min]="missionOrderEmployee.start" />
              <mat-datepicker-toggle matSuffix [for]="missionOrderEmployeeEndPicker"></mat-datepicker-toggle>
              <mat-datepicker #missionOrderEmployeeEndPicker></mat-datepicker>
            </mat-form-field>

            <button mat-mini-fab color="accent" type="button" (click)="addMissionOrderEmployee()">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          <div *ngIf="newMissionOrder.missionOrderEmployees.length != 0">
            <table width="100%" class="border-b-2 border-gray-100 shadow-lg bg-white border-separate">
              <thead>
                <tr>
                  <th class="border-t-2 border-l-2 border-gray-100">Client</th>
                  <th class="border-t-2 border-l-2 border-gray-100">Jours facturés</th>
                  <th class="border-t-2 border-l-2 border-gray-100">Dates</th>
                </tr>
              </thead>
              <tbody *ngFor="
                        let item of newMissionOrder.missionOrderEmployees;
                        index as missionOrderEmployeeIndex
                      ">
                <tr class="text-center">
                  <td class="border-t-2 border-l-2 border-gray-100">{{ item.employee.fullName }}</td>
                  <td class="border-t-2 border-l-2 border-gray-100">{{ item.daysWork }}</td>
                  <td class="border-t-2 border-l-2 border-gray-100">
                    <div class="flex flex-row items-center place-content-center">
                      <div>
                        du
                        <span>{{ item.start | date: "dd/MM/yyyy" }}</span>
                        au
                        <span>{{ item.end | date: "dd/MM/yyyy" }}</span>
                      </div>
                      <button color="warn" mat-icon-button aria-label="remove client" (click)="
                                removeMissionOrderEmployee(
                                  missionOrderEmployeeIndex
                                )
                              ">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>

                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="mt-8 flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button matStepperPrevious color="accent">
              Précédent
            </button>
            <button class="ml-2" mat-raised-button matStepperNext color="accent">
              Suivant
            </button>
          </div>
        </div>
      </mat-step>
      <!-- Frais -->
      <mat-step label="Frais" [optional]="true">
        <div>
          <div class="flex flex-row items-baseline">
            <mat-form-field appearance="outline" class=" mr-2">
              <mat-label>Choisir un type</mat-label>
              <mat-select name="typeCost" [(ngModel)]="missionOrderCost.costType">
                <mat-option *ngFor="let type of costsTypes" [value]="type">
                  {{ type.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" class="" style="border-color: red !important;">
              <mat-label>Montant</mat-label>
              <input matInput type="number" [(ngModel)]="missionOrderCost.cost" placeholder="Montant en €" name="cost"
                (input)="checkCost()" />
            </mat-form-field>
            <mat-checkbox class="ml-2" [(ngModel)]="missionOrderCost.isPersonalCost" name="isPersonalCost">Frais perso ?
            </mat-checkbox>
            <button class="ml-2" mat-mini-fab color="accent" type="button" (click)="addMissionOrderCost()">
              <mat-icon>add</mat-icon>
            </button>
          </div>

          <div *ngIf="newMissionOrder.costs.length != 0">
            <table width="100%" class="border-b-2 shadow-lg bg-white border-separate">
              <thead>
                <tr>
                  <th class="border-t-2 border-l-2 border-gray-100">Type</th>
                  <th class="border-t-2 border-l-2 border-gray-100">Montant</th>

                </tr>
              </thead>
              <tbody *ngFor="
                        let cost of newMissionOrder.costs;
                        index as costIndex
                      ">
                <tr class="text-center">
                  <td class="border-t-2 border-l-2  border-gray-100 ">
                    {{ cost.costType.name }}
                    {{ cost.isPersonalCost ? " (Frais personnel)" : "" }}
                  </td>
                  <td class="border-t-2 border-x-2  border-gray-100 ">
                    <div class="flex flex-row items-center place-content-center">
                      {{ cost.cost }}

                      <button color="warn" mat-icon-button aria-label="remove cost"
                        (click)="removeMissionOrderCost(costIndex)">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="mt-8 flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button matStepperPrevious color="accent">
              Précédent
            </button>
            <button class="ml-2" mat-raised-button matStepperNext color="accent">
              Suivant
            </button>
          </div>
        </div>

      </mat-step>
      <!-- Remise -->
      <mat-step label="Remise" [optional]="true">
        <div>
          <div>
            <mat-form-field appearance="outline">
              <mat-label>Montant de la remise</mat-label>
              <input matInput type="number" [(ngModel)]="newMissionOrder.rebate" placeholder="Montant en €"
                name="rebate" (input)="checkRebate()" />
            </mat-form-field>
            <div>
              <div class="p-2 bg-gray-100">
                <p>
                  Remise :
                  {{
                  newMissionOrder.rebate == null
                  ? ""
                  : newMissionOrder.rebate
                  }}
                </p>
                <p>{{ "Total des frais : " + getTotalFrais() }}</p>
                <p>
                  {{ "Total des frais perso : " + getTotalFraisPerso() }}
                </p>
                <p>{{ "Intervenants : " + getTotalIntervenants() }}</p>
                <p>{{ "TOTAL (après remise) : " + getTotal() }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-8 flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button matStepperPrevious color="accent">
              Précédent
            </button>
            <button class="ml-2" mat-raised-button matStepperNext color="accent">
              Suivant
            </button>
          </div>
        </div>
      </mat-step>
      <!-- Rapport -->
      <mat-step label="Rapport" [optional]="true">
        <div>
          <angular-editor [config]="config" [(ngModel)]="newMissionOrder.report" name="report"></angular-editor>
        </div>

        <div class="mt-8 flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button matStepperPrevious color="accent">
              Précédent
            </button>
            <button mat-raised-button class="mx-2" color="primary" type="submit" [disabled]="f.invalid"
              (click)="onSubmit(f, true)">
              Brouillon <mat-icon>build</mat-icon>
            </button>
            <button mat-raised-button color="accent" type="submit"
              [disabled]="f.invalid || newMissionOrder.clients.length <= 0" (click)="onSubmit(f)">
              Sauvegarder <mat-icon class="ml-1">save</mat-icon>
            </button>
          </div>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
    <!-- Stepper vertical -->
    <mat-vertical-stepper *ngIf="smallScreen" labelPosition="bottom" [linear]="true">
      <!-- Mission infos -->
      <mat-step label="Mission infos" ngModelGroup="generalInfo" #generalInfo="ngModelGroup"
        [stepControl]="generalInfo">
        <div class="w-full flex flex-col">
          <mat-form-field appearance="outline">
            <mat-label>Objet de la mission</mat-label>
            <input #title="ngModel" [(ngModel)]="newMissionOrder.title" placeholder="Objet de la mission" matInput
              name="title" required minlength="3" />
            <mat-error *ngIf="title.invalid && (title.dirty || title.touched)">
              Veuillez renseigner le titre (3 caractères minimum) !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Début de la mission</mat-label>
            <input #start="ngModel" matInput [matDatepicker]="startPicker" placeholder="Début de la mission"
              [(ngModel)]="newMissionOrder.missionStart" name="startPicker" required />
            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            <mat-error *ngIf="start.invalid && (start.dirty || start.touched)">
              Veuillez renseigner la date de début de la mission !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Fin de la mission</mat-label>
            <input #end="ngModel" matInput [matDatepicker]="endPicker" placeholder="Début de la mission"
              [(ngModel)]="newMissionOrder.missionEnd" name="endPicker" required [min]="newMissionOrder.missionStart" />
            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
            <mat-error *ngIf="end.invalid && (end.dirty || end.touched)">
              Veuillez renseigner la date de fin de la mission !
            </mat-error>
          </mat-form-field>
        </div>
      </mat-step>
      <!-- Clients -->
      <mat-step label="Clients" [optional]="data.mode == 'edit'">

        <div class="flex flex-col w-full">
          <mat-form-field appearance="outline">
            <mat-label>Client</mat-label>
            <input #client="ngModel" matInput [(ngModel)]="clientName" placeholder="Ajouter un client" name="client" />
          </mat-form-field>
          <button type="button" color="accent" mat-icon-button aria-label="add client" (click)="addClient()">
            <mat-icon>check</mat-icon>
          </button>
        </div>
        <div *ngIf="newMissionOrder.clients.length != 0" class="flex flex-col w-full">

          <mat-form-field appearance="outline">
            <mat-label>Site</mat-label>
            <input matInput [(ngModel)]="siteName" placeholder="Ajouter un site" name="site" />
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Clients</mat-label>
            <mat-select name="clients" [(ngModel)]="clientIndex">
              <mat-option *ngFor="
                        let client of newMissionOrder.clients;
                        index as clientIndex
                      " [value]="clientIndex">
                {{ client.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <button type="button" mat-icon-button color="accent" aria-label="add site" (click)="addSite(clientIndex)">
            <mat-icon>add</mat-icon>
          </button>
        </div>
        <div *ngIf="newMissionOrder.clients.length != 0" class="flex flex-col w-full">

          <table width="100%" class="border-b-2 shadow-lg bg-red border-separate">
            <thead>
              <tr>
                <th width="50%" class="border-t-2 border-l-2 border-gray-100">Client</th>
                <th width="50%" class="border-t-2 border-x-2 border-gray-100">Sites</th>
              </tr>
            </thead>
            <tbody *ngFor="
                        let client of newMissionOrder.clients;
                        index as clientIndex
                      ">
              <tr>
                <td class="border-t-2 border-l-2 border-gray-100">

                  {{ client.name }}
                  <button color="warn" mat-icon-button aria-label="remove client" (click)="removeClient(clientIndex)">
                    <mat-icon>close</mat-icon>
                  </button>
                </td>
                <td class="border-t-2 border-x-2 border-gray-100">

                  <p *ngFor="
                              let site of client.sites;
                              index as siteIndex
                            ">
                    {{ site.name }}
                    <button color="warn" mat-icon-button aria-label="remove site"
                      (click)="removeSite(clientIndex, siteIndex)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </p>
                </td>
              </tr>
            </tbody>
          </table>

        </div>

      </mat-step>
      <!-- Intervenants -->
      <mat-step label="Intervenants" [optional]="true">
        <div>
          <div>
            <div class="flex flex-col w-full ">
              <mat-form-field appearance="outline" class="">
                <mat-label>Choisir un salarié</mat-label>
                <mat-select name="employee" [(ngModel)]="missionOrderEmployee.employee">
                  <mat-option>
                    <ngx-mat-select-search ngModel name="searchINput" (ngModelChange)="searchEmployee($event)"
                      placeholderLabel="Rechercher" noEntriesFoundLabel="pas de resultats"></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let employee of filtredEmployees" [value]="employee">
                    {{ employee.fullName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" class="">
                <mat-label>Nombre de jours facturés</mat-label>
                <mat-select name="days" [(ngModel)]="missionOrderEmployee.daysWork">
                  <mat-option *ngFor="let day of dayWorks" [value]="day.day">
                    {{ day.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" class="">
                <mat-label>Date de départ</mat-label>
                <input matInput [matDatepicker]="missionOrderEmployeeStartPicker" placeholder="Début de la mission"
                  [(ngModel)]="missionOrderEmployee.start" name="missionOrderEmployeeStartPicker"
                  [min]="newMissionOrder.missionStart" />
                <mat-datepicker-toggle matSuffix [for]="missionOrderEmployeeStartPicker"></mat-datepicker-toggle>
                <mat-datepicker #missionOrderEmployeeStartPicker></mat-datepicker>
              </mat-form-field>
              <mat-form-field appearance="outline" class="">
                <mat-label>Date de fin</mat-label>
                <input matInput [matDatepicker]="missionOrderEmployeeEndPicker" placeholder="Début de la mission"
                  [(ngModel)]="missionOrderEmployee.end" name="missionOrderEmployeeEndPicker"
                  [min]="missionOrderEmployee.start" />
                <mat-datepicker-toggle matSuffix [for]="missionOrderEmployeeEndPicker"></mat-datepicker-toggle>
                <mat-datepicker #missionOrderEmployeeEndPicker></mat-datepicker>
              </mat-form-field>

              <button class="my-4" mat-mini-fab color="accent" type="button" (click)="addMissionOrderEmployee()">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <div *ngIf="newMissionOrder.missionOrderEmployees.length != 0">
              <table width="100%" class="mt-2  
              border-b-2 shadow-lg bg-white 
              border-separate">
            
                <thead>
                  <tr class="text-left">
                    <th class="border-t-2 border-l-2 border-gray-100">Client</th>
                    <th class="border-t-2 border-l-2 border-gray-100">Jours facturés</th>
                    <th class="border-t-2 border-x-2 border-gray-100">Dates</th>
                 
                  </tr>
                </thead>
                <tbody *ngFor="
                        let item of newMissionOrder.missionOrderEmployees;
                        index as missionOrderEmployeeIndex
                      ">
                  <tr>
                 
                  <td class="border-t-2 border-l-2 border-gray-100">

                      {{ item.employee.fullName }}</td>
                  <td class="border-t-2 border-l-2 border-gray-100">
                    {{ item.daysWork }}</td>
                  <td class="border-t-2 border-x  -2 border-gray-100">
                    
                      <div class="flex flex-row items-center">
                        <div>
                          du
                          <span>{{ item.start | date: "dd/MM/yyyy" }}</span>
                          au
                          <span>{{ item.end | date: "dd/MM/yyyy" }}</span>
                        </div>
                        <button color="warn" mat-icon-button aria-label="remove client" (click)="
                              removeMissionOrderEmployee(
                                missionOrderEmployeeIndex
                              )
                            ">
                          <mat-icon>close</mat-icon>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </mat-step>
      <!-- Frais -->
      <mat-step label="Frais" [optional]="true">
        <div>
          <div>
            <div class="flex flex-col ">
              <mat-form-field appearance="outline" class="">
                <mat-label>Choisir un type</mat-label>
                <mat-select name="typeCost" [(ngModel)]="missionOrderCost.costType">
                  <mat-option *ngFor="let type of costsTypes" [value]="type">
                    {{ type.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" class="">
                <mat-label>Montant</mat-label>
                <input matInput type="number" [(ngModel)]="missionOrderCost.cost" placeholder="Montant en €" name="cost"
                  (input)="checkCost()" />
              </mat-form-field>
              <mat-checkbox [(ngModel)]="missionOrderCost.isPersonalCost" name="isPersonalCost">Frais perso ?
              </mat-checkbox>
              <button class="my-5" mat-mini-fab color="accent" type="button" (click)="addMissionOrderCost()">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <div *ngIf="newMissionOrder.costs.length != 0">
              <table width="100%" class="  border-b-2 shadow-lg bg-white border-separate">
            
                <thead>
                  <tr class="text-left">
                    <th 
                  class="border-t-2 border-l-2
                   border-gray-100"> 
                  Type</th>
                  <th 
                  class="border-t-2 border-x-2
                   border-gray-100"> Montant</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody *ngFor="
                        let cost of newMissionOrder.costs;
                        index as costIndex
                      ">
                  <tr>
                    <td class="border-t-2 border-l-2 border-gray-100">

                      {{ cost.costType.name }}
                      {{ cost.isPersonalCost ? " (Frais personnel)" : "" }}
                    </td>
                  <td class="border-t-2 border-x-2 border-gray-100">
                  <div class="flex flex-row items-center">
                    {{ cost.cost }}
                    <button color="warn" mat-icon-button aria-label="remove cost"
                      (click)="removeMissionOrderCost(costIndex)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </mat-step>
      <!-- Remise -->
      <mat-step label="Remise" [optional]="true">
        <div>
          <div class="w-full flex flex-col ">
            <mat-form-field appearance="outline" class=""> 
              <mat-label>Montant de la remise</mat-label>
              <input matInput type="number" [(ngModel)]="newMissionOrder.rebate" placeholder="Montant en €"
                name="rebate" (input)="checkRebate()" />
            </mat-form-field>
            <div>
              <div class="bg-gray-100 p-2">
                <p>
                  Remise :
                  {{
                  newMissionOrder.rebate == null
                  ? ""
                  : newMissionOrder.rebate
                  }}
                </p>
                <p>{{ "Total des frais : " + getTotalFrais() }}</p>
                <p>
                  {{ "Total des frais perso : " + getTotalFraisPerso() }}
                </p>
                <p>{{ "Intervenants : " + getTotalIntervenants() }}</p>
                <p>{{ "TOTAL (après remise) : " + getTotal() }}</p>
              </div>
            </div>
          </div>
        </div>
      </mat-step>
      <!-- Rapport -->
      <mat-step label="Rapport" [optional]="true">
        <div >
          <angular-editor [config]="config" [(ngModel)]="newMissionOrder.report" name="report"></angular-editor>
        </div>
      </mat-step>
    </mat-vertical-stepper>
  </form>
  <div *ngIf="smallScreen" mat-dialog-actions class="p-8 flex flex-col sm:flex-row  justify-between">
    <div class="ml-auto ">
      <button mat-raised-button color="primary" type="submit" [disabled]="f.invalid" (click)="onSubmit(f, true)">
        Brouillon <mat-icon class="ml-1">build</mat-icon>
      </button>
      <button class="mt-2 sm:mt-0" mat-raised-button color="accent" type="submit"
        [disabled]="f.invalid || newMissionOrder.clients.length <= 0" (click)="onSubmit(f)">
        Sauvegarder <mat-icon class="ml-1">save</mat-icon>
      </button>
    </div>
  </div>
</div>