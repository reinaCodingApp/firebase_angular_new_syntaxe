<div *ngIf="missionOrder" class="pt-3 overflow-y-auto max-h-140 w-full">

  <div id="non-printable" class="flex flex-col sm:flex-row sm:items-end items-end justify-between">
    <div class="ml-auto">
      <button mat-icon-button color="primary" class="mat-elevation-z1 mr-4" (click)="print()">
        <mat-icon>print</mat-icon>
      </button>
    </div>
  </div>
  <div class="flex flex-col  items-center">
    <h2 class="text-xl">OBJET DE LA MISSION</h2>
    <h3 class="text-lg mt-4">{{ missionOrder.title }}</h3>
  </div>
  <div class="p-4">
    <div class="flex items-center flex-row mb-8">
      <div class="w-1/3">
        <span class="font-bold">Début de la mission</span>
      </div>
      <div class="w-2/3 min-w-2/3 p-2 bg-gray-100">
        <span>{{
          missionOrder.missionStart | date: "dd/MM/yyyy"
          }}</span>
      </div>
    </div>

    <div class="flex items-center flex-row mb-8">
      <div class="w-50">
        <span class="font-bold">Fin de la mission</span>
      </div>
      <div class="w-100 max-w-100 p-2 bg-gray-100">
        <span>{{
          missionOrder.missionEnd | date: "dd/MM/yyyy"
          }}</span>
      </div>
    </div>

    <div class="flex flex-row mb-8 ">
      <div class="w-50">        
        <span class="font-bold">Clients</span>
      </div>
        <div class="max-w-100  p-2 bg-gray-100 ">
          <table width="100%" class="w-full">
            <thead class="text-left">
              <tr class="text-left">
                <th>Client</th>
                <th>Sites</th>
              </tr>
            </thead>
            <tbody *ngFor="let client of missionOrder.clients">
              <tr>
                <td>{{ client.name }}</td>
                <td>
                  <p *ngFor="let site of client.sites">{{ site.name }}</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
    </div>
    <div class="flex flex-row mb-8">
      <div class="w-50">    
        <span class="font-bold">Intervenants</span>
      </div>
      <div>
      <div class="w-full p-2 bg-gray-100">
          <table width="100%">
            <thead>
              <tr class="text-left">
                <th>Client</th>
                <th>Jours facturés</th>
                <th>Dates</th>
              </tr>
            </thead>
            <tbody *ngFor="let item of missionOrder.missionOrderEmployees">
              <tr>
                <td>{{ item.employee.fullName }}</td>
                <td>{{ item.daysWork }}</td>
                <td>
                  du <span>{{ item.start | date: "dd/MM/yyyy" }}</span> au
                  <span>{{ item.end | date: "dd/MM/yyyy" }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="flex items-center flex-row mb-8">
      <div class="w-50">        
        <span class="font-bold">Frais</span>
      </div>
      <div  class="w-full p-2 bg-gray-100">
        <span>
          <p>{{ "Remise : " + missionOrder.rebate }}</p>
          <p>{{ "Total des frais : " + getTotalFrais() }}</p>
          <p>{{ "Total des frais perso : " + getTotalFraisPerso() }}</p>
          <p>{{ "Intervenants : " + getTotalIntervenants() }}</p>
          <p>{{ "TOTAL (après remise) : " + getTotal() }}</p>
        </span>
      </div>
    </div>
    <div class="flex items-center flex-row mb-8">
      <div class="w-50">        
        <span class="font-bold">Rapport</span>
      </div>
      <div class="w-full p-2 bg-gray-100">
        <span   [innerHTML]="missionOrder.report"> </span>
      </div>
    </div>
  </div>
  <div id="non-printable" *ngIf="habilitation.isAdmin()" class="flex flex-col items-center">
    <h2 class="text-2xl">Traitement</h2>
    <div class="flex flex-row items-baseline mt-4">
      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="currentInvoiceState" name="status">
          <mat-option *ngFor="let status of missionOrderstatus" [value]="status.value">
            {{ status.title }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-icon-button color="primary" class="ml-3 mat-elevation-z1" (click)="changeState(missionOrder)">
        <mat-icon class="ml-1">check</mat-icon>
      </button>
    </div>
  </div>
</div>