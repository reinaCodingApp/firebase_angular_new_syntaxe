<div class="flex flex-col max-w-240 md:min-w-160 max-h-screen -m-6">

  <!-- Header -->
  <div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
    <div class="text-lg font-medium">{{
      data.mode == "edit" ? "Modifier un site" : "Ajouter un site"
      }}</div>
    <button mat-icon-button (click)="matDialogRef.close()" [tabIndex]="-1">
      <mat-icon  class="text-current" [svgIcon]="'heroicons_outline:x'"></mat-icon>
    </button>
  </div>

  <div fusePerfectScrollbar>
    <ng-template #addForm>
      <form #f="ngForm" (ngSubmit)="onSubmit(f)" name="composeForm"
        class="flex flex-col flex-auto p-6 overflow-y-auto">
        <mat-form-field appearance="outline">
          <mat-label>Nom</mat-label>
          <input #name="ngModel" [(ngModel)]="site.name" placeholder="Nom de site" matInput name="name" required
            minlength="3" />
          <mat-error *ngIf="name.invalid && (name.dirty || name.touched)">
            Veuillez renseigner le nom (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Adresse</mat-label>
          <input #address="ngModel" [(ngModel)]="site.address" placeholder="Adresse de site" matInput name="address"
            required minlength="3" />
          <mat-error *ngIf="address.invalid && (address.dirty || address.touched)">
            Veuillez renseigner l'adresse (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Ville</mat-label>
          <input #city="ngModel" [(ngModel)]="site.city" placeholder="Ville de site" matInput name="city" required
            minlength="3" />
          <mat-error *ngIf="city.invalid && (city.dirty || city.touched)">
            Veuillez renseigner la ville (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Code postal</mat-label>
          <input #zipCode="ngModel" [(ngModel)]="site.zipCode" placeholder="Code postal" matInput name="zipCode"
            required minlength="3" />
          <mat-error *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched)">
            Veuillez renseigner le code postal (3 caractères minimum) !
          </mat-error>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Pays</mat-label>
          <input [(ngModel)]="site.country" placeholder="Pays" matInput name="country" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Les coordonnées GPS</mat-label>
          <input [value]="'Lat. :' + site.latitude + 'Lon. :' + this.site.longitude" placeholder="Les coordonnées GPS"
            matInput name="siteCoordonate" readonly required />
          <button style="bottom: 10px;" type="button" mat-raised-button matPrefix (click)="getCoordinateFromAddress()">
            Obtenir
          </button>
          <button mat-icon-button type="button" matPrefix (click)="getCoordinateFromAddress()">
            <mat-icon>location_on</mat-icon>
          </button>
          <button style="bottom: 10px;" type="button" mat-raised-button matSuffix (click)="openGoogleMaps()">
            Géolocaliser
          </button>
          <button mat-icon-button type="button" matSuffix (click)="openGoogleMaps()">
            <mat-icon>gps_fixed</mat-icon>
          </button>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Téléphone</mat-label>
          <input [(ngModel)]="site.phone" placeholder="Téléphone" matInput name="phone" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Fax</mat-label>
          <input [(ngModel)]="site.fax" placeholder="Fax" matInput name="fax" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Numéro d'agrément</mat-label>
          <input [(ngModel)]="site.agreementNumber" placeholder="Numéro d'agrément" matInput name="agreementNumber"
            readonly required />
          <button style="bottom: 10px;" type="button" mat-raised-button matSuffix [disabled]="zipCode.invalid"
            (click)="generateAgreementNumber()">
            Générer N°
          </button>
          <button mat-icon-button type="button" matSuffix [disabled]="zipCode.invalid"
            (click)="generateAgreementNumber()">
            <mat-icon>autorenew</mat-icon>
          </button>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Contact</mat-label>
          <input [(ngModel)]="site.contact" placeholder="Contact" matInput name="contact" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input [(ngModel)]="site.email" placeholder="Email" matInput name="email" />
        </mat-form-field>
        <mat-checkbox [(ngModel)]="site.displayInTheWebSite" name="displayInTheWebSite" class="pb-20">Afficher sur le
          site
        </mat-checkbox>
        <mat-form-field appearance="outline">
          <mat-label>Raison Social</mat-label>
          <input [(ngModel)]="site.companyName" placeholder="Raison Social" matInput name="companyName" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Site internet</mat-label>
          <input [(ngModel)]="site.webSite" placeholder="Site internet" matInput name="webSite" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Estampille vétérinaire</mat-label>
          <input [(ngModel)]="site.veterinaryStamp" placeholder="Estampille vétérinaire" matInput
            name="veterinaryStamp" />
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Remarques</mat-label>
          <input [(ngModel)]="site.comment" placeholder="Remarques" matInput name="comment" />
        </mat-form-field>
        <mat-form-field appearance="outline" *ngIf="data.mode === 'new'">
          <mat-label>Séletionner une zone</mat-label>
          <mat-select name="departments" [(ngModel)]="site.department" required>
            <mat-option *ngFor="let department of departments" [value]="department">
              {{ department.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" *ngIf="data.mode === 'new'">
          <mat-label>Types du partenaire</mat-label>
          <mat-select name="siteTypes" [(ngModel)]="site.siteTypes" multiple required>
            <mat-option *ngFor="let siteType of siteTypes" [value]="siteType">
              {{ siteType.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>


        <!-- Actions -->
        <div class="flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button class="sm:mx-3" mat-stroked-button *ngIf="mode == 'add'" type="submit" (click)="addAdvanceSalary()">
              <span>Créer</span>
            </button>
            <button class="order-first sm:order-last" mat-flat-button [color]="'primary'" *ngIf="mode == 'edit'"
              (click)="updateAdvanceSalary()" type="submit">
              Mettre à jour
            </button>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-end items-end justify-between">
          <div class="ml-auto">
            <button mat-raised-button color="accent" type="submit">
              {{ data.mode == "edit" ? "Modifier" : "Créer" }}
              <mat-icon class="ml-1">check</mat-icon>
            </button>
          </div>
        </div>




      </form>
    </ng-template>
    <ng-template #completeRestaurant>
      <mat-tab-group mat-align-tabs="center" mat-stretch-tabs class="pt-4">
        <mat-tab label="Site">
          <div class="tab-content">
            <ng-container *ngTemplateOutlet="addForm"></ng-container>
          </div>
        </mat-tab>
        <mat-tab label="Restaurant">
          <div class="tab-content">
            <form #f2="ngForm" (ngSubmit)="updateRestaurantInformation(f2)"
             name="restaurantForm"
              class="flex flex-col overflow-y-auto">
              <mat-form-field appearance="outline">
                <mat-label>Horaires d'ouverture</mat-label>
                <input [(ngModel)]="site.openingTime" placeholder="Horaires d'ouverture" matInput name="openingTime" />
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Jours de fermeture</mat-label>
                <input [(ngModel)]="site.closingDays" placeholder="Jours de fermeture" matInput name="closingDays" />
              </mat-form-field>
              <mat-checkbox [(ngModel)]="site.isBookingPrefered" name="isBookingPrefered">Réservation conseillée ?
              </mat-checkbox>
              <mat-form-field appearance="outline">
                <mat-label>Nombre de places</mat-label>
                <input [(ngModel)]="site.numberOfSeats" placeholder="Nombre de places" matInput type="number"
                  name="numberOfSeats" />
              </mat-form-field>
              <custom-chip-list [labelTitle]="'Types de restaurants'" [allItems]="restaurantTypes"
                [selectedItems]="site.restaurantTypes"></custom-chip-list>
              <custom-chip-list [labelTitle]="'Options'" [allItems]="restaurantOptions"
                [selectedItems]="site.restaurantOptions"></custom-chip-list>
              <custom-chip-list [labelTitle]="'Spécialités'" [allItems]="restaurantSpecialies"
                [selectedItems]="site.restaurantSpecialies"></custom-chip-list>
              <div class="flex flex-col sm:flex-row sm:items-end items-end justify-between">
                <div class="ml-auto">
                  <button mat-raised-button color="accent" type="submit">
                    Mettre à jour
                    <mat-icon class="ml-1">check</mat-icon>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </mat-tab>
      </mat-tab-group>
    </ng-template>
    <ng-container *ngIf="
        data.mode == 'new' ||
          (data.mode == 'edit' && !showRestaurantExtra(site));
        else completeRestaurant
      ">
      <ng-container *ngTemplateOutlet="addForm"> </ng-container>
    </ng-container>
  </div>
</div>