<div class="flex flex-col w-full p-6" *ngIf="focus?.focusDetails">
  <div class="flex flex-row items-center">
    <button matTooltip="Gestion de contenu" mat-icon-button class="back" [routerLink]="'/website'">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h2 class="pl-4 text-2xl">{{mode == 'edit' ? "Modifier focus" : "Nouveau focus"}}</h2>
  </div>

  <div class="w-full flex  gap-1 flex-col-reverse sm:flex-row">
    <div class="p-4 w-full sm:w-3/4 ">
      <!-- Title,Subtitle,Date,Excerpt -->
      <div class="mat-card  p-4 mb-2">
        <div class="mb-4">
          <div class="text-xl">Focus info</div>
        </div>
        <form #f="ngForm" name="addFocusForm" class="flex flex-col">
          <mat-form-field appearance="outline">
            <mat-label>Titre</mat-label>
            <input #title="ngModel" [(ngModel)]="focus.title" name="title" matInput required minlength="10" />
            <mat-error *ngIf="title.invalid && (title.dirty || title.touched)">
              Veuillez renseigner le titre (10 caractères minimum) !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Sous-titre</mat-label>
            <input #subTitle="ngModel" [(ngModel)]="focus.subTitle" name="subTitle" matInput required minlength="10" />
            <mat-error *ngIf="subTitle.invalid && (subTitle.dirty || subTitle.touched)">
              Veuillez renseigner le sous-titre (10 caractères minimum) !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Date</mat-label>
            <input #date="ngModel" required matInput [matDatepicker]="datePicker" placeholder="Date"
              [(ngModel)]="focus.date" name="date" />
            <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
            <mat-datepicker #datePicker></mat-datepicker>
            <mat-error *ngIf="date.invalid && (date.dirty || date.touched)">
              Veuillez renseigner la date !
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Extrait</mat-label>
            <textarea matInput placeholder="Extrait" name="excerpt" required [(ngModel)]="focus.excerpt" minlength="10"
              rows="5"></textarea>
            <mat-error *ngIf="date.invalid && (date.dirty || date.touched)">
              Veuillez renseigner l'extrait (10 caractères minimum) !
            </mat-error>
          </mat-form-field>
        </form>
      </div>
      <!-- Descrptions Block -->
      <div class="mat-card p-4 mb-2">
        <div class="mb-4">
          <div class="text-2xl">Blocs de description</div>
        </div>
        <div>
          <mat-accordion class="mat-card">
            <mat-expansion-panel [expanded]="false"
              *ngFor="let descriptionBlock of focus?.focusDetails?.descriptionsBlock"
              class="mb-1 h-12">
              <mat-expansion-panel-header (keydown.Space)="$event.stopImmediatePropagation();">
                <mat-panel-title>
                  <input [(ngModel)]="descriptionBlock.title" name="descriptionBlock" matInput />
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="flex flex-col w-full">
                <mat-form-field appearance="outline">
                  <mat-label>Contenu</mat-label>
                  <textarea matInput placeholder="Presentation" name="content" [(ngModel)]="descriptionBlock.content"
                    rows="5"></textarea>
                </mat-form-field>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>
      <!-- Illustractions -->
      <div class="mat-card p-4 mb-2">
        <div class="mb-4">
          <div class="text-2xl">Illustractions</div>
        </div>
        <div>
          <mat-accordion>
            <mat-expansion-panel [expanded]="false"
              *ngFor="let illustration of focus?.focusDetails?.illustrations; index as i" 
              class="mb-1 h-12">
              <mat-expansion-panel-header (keydown.Space)="$event.stopImmediatePropagation();">
                <mat-panel-title>
                  <input [(ngModel)]="illustration.title" name="illustration" matInput />
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="flex flex-col w-full">
                <div class="p-4">
                  <div class="image">
                    <img *ngIf="illustration.image && illustration.image.length > 0" [src]="illustration.image"
                      class="huge m-0" />
                  </div>
                  <div class="flex flex-col items-center">
                    <button mat-fab color="warn" type="button" class="upload" (click)="illustrationImage.click()">
                      <!-- <mat-icon>{{
                        illustration.image && illustration.image.length > 0 ? "edit" : "add_photo_alternatet"
                        }}</mat-icon> -->


                      <mat-icon *ngIf="!illustration.image 
                        || illustration.image.length <= 0" svgIcon="mat_outline:image"></mat-icon>


                      <mat-icon *ngIf=" illustration.image && illustration.image.length > 0 ">edit</mat-icon>


                    </button>
                    <input name="illustrationImage" (change)="uploadImageForIllustration($event, i)" type="file"
                      #illustrationImage hidden accept="image/*" />
                  </div>
                </div>
                <mat-form-field appearance="outline">
                  <mat-label>Commentaires</mat-label>
                  <textarea matInput placeholder="Presentation" name="comment" [(ngModel)]="illustration.comment"
                    rows="5"></textarea>
                </mat-form-field>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>
      <!-- Images -->
      <div class="mat-card p-4 mb-2">
        <div class="mb-4">
          <div class="text-2xl">Images</div>
        </div>
        <div class="flex flex-col items-center my-4">
          <button mat-fab color="warn" type="button" class="upload" (click)="file.click()">
            <mat-icon svgIcon="mat_outline:image"></mat-icon>
          </button>
          <input name="focusImages" (change)="uploadImageForFocus($event)" type="file" #file hidden accept="image/*" />
        </div>
        <div>



          <div *ngFor="let image of focus?.images; index as i">
            <div *ngIf="focus?.images.length > 0" class="mb-4">
              <div class="w-full flex">
                <div class="h-48 w-58 relative z-0">
                  <img class="h-48 w-58" [src]="image">
                  <div class="absolute inset-0 flex justify-end items-start z-10">
                    <button class="bg-white m-3" mat-icon-button color="warn" (click)="removeImage(i)">
                      <mat-icon>delete_outline</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Info -->
      <mat-accordion class="  p-4 mb-2  ">
        <mat-expansion-panel [expanded]="false">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <h2 class="text-2xl">Info complémentaires</h2>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <form class="flex flex-col ">
            <mat-form-field appearance="outline">
              <mat-label>Adresse</mat-label>
              <input [(ngModel)]="focus.focusDetails.address" name="address" matInput />
            </mat-form-field>
            <div class="flex flex-col sm:flex-row justify-between w-full">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Latitude</mat-label>
                <input [(ngModel)]="focus.focusDetails.location.latitude" name="latitude" matInput type="number" />
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-full ml-0 sm:ml-2">
                <mat-label>Longitude</mat-label>
                <input [(ngModel)]="focus.focusDetails.location.longitude" name="longitude" matInput type="number" />
              </mat-form-field>
            </div>
            <div class="flex flex-col sm:flex-row ">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Ville</mat-label>
                <input [(ngModel)]="focus.focusDetails.city" name="city" matInput />
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-full ml-0 sm:ml-2">
                <mat-label>Code Postal</mat-label>
                <input [(ngModel)]="focus.focusDetails.zipCode" name="zipCode" matInput />
              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row ">

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Pays</mat-label>
                <input [(ngModel)]="focus.focusDetails.country" name="country" matInput />
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-full ml-0 sm:ml-2">
                <mat-label>Téléphone</mat-label>
                <input [(ngModel)]="focus.focusDetails.phone" name="phone" matInput />
              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row">

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Email</mat-label>
                <input [(ngModel)]="focus.focusDetails.email" name="email" matInput />
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-full ml-0 sm:ml-2">
                <mat-label>Site Web</mat-label>
                <input [(ngModel)]="focus.focusDetails.webSite" name="webSite" matInput />
              </mat-form-field>
            </div>

            <div class="w-full flex flex-col sm:flex-row ">

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Twitter</mat-label>
                <input [(ngModel)]="focus.focusDetails.twitter" name="twitter" matInput />
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-full ml-0 sm:ml-2">
                <mat-label>Facebook</mat-label>
                <input [(ngModel)]="focus.focusDetails.facebook" name="facebook" matInput />
              </mat-form-field>
            </div>

            <div class="flex flex-col sm:flex-row ">

              <mat-form-field appearance="outline" class="pr-md-8">
                <mat-label>Instagram</mat-label>
                <input [(ngModel)]="focus.focusDetails.instagram" name="instagram" matInput />
              </mat-form-field>
            </div>
          </form>
        </mat-expansion-panel>
      </mat-accordion>
      <!-- Videos -->
      <div class="max-h-max mat-card p-4 mb-2">
        <div class="mb-4">
          <div class="text-2xl">Videos</div>
        </div>
        <ckeditor [editor]="editor" [config]="config" [(ngModel)]="focus.focusDetails.videos"
         name="editor"
          (ready)="onEditorReady($event)">
        </ckeditor>
      </div>
    </div>
    <div class="w-full sm:w-1/4">
      <div class="flex flex-col items-center pt-4">
        <button mat-raised-button (click)="onSubmit(f)" color="primary" aria-label="SAVE" type="submit">
          {{ mode === "new" ? "Créer" : "Modifier" }}
        </button>
        <mat-checkbox class="my-4 " [(ngModel)]="focus.published">Publié?</mat-checkbox>
      </div>

      <div class="mat-card p-4 mb-2 mt-2">
        <div class="pb-2 text-2xl">Interlocuteur</div>
        <img *ngIf="focus.focusDetails.interlocutor.image && focus.focusDetails.interlocutor.image.length > 0"
          [src]="focus.focusDetails.interlocutor.image" class="huge m-0" />
        <div class="my-4 flex items-center place-content-center">
          <button mat-fab color="warn" type="button" class="upload" (click)="interLocutorImage.click()">

            <mat-icon *ngIf="!focus.focusDetails.interlocutor.image || focus.focusDetails.interlocutor.image.length < 0"
              svgIcon="mat_outline:image"></mat-icon>

            <mat-icon
              *ngIf="focus.focusDetails.interlocutor.image  && focus.focusDetails.interlocutor.image.length > 0">edit
            </mat-icon>

          </button>
          <input name="interlocutorImage" (change)="uploadImageForInterlocutor($event)" type="file" #interLocutorImage
            hidden accept="image/*" />
        </div>

        <form class="flex flex-col">
          <mat-form-field appearance="outline">
            <mat-label>Nom</mat-label>
            <input [(ngModel)]="focus.focusDetails.interlocutor.lastName" name="lastName" matInput />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Prénom</mat-label>
            <input [(ngModel)]="focus.focusDetails.interlocutor.firstName" name="firstName" matInput />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Profession</mat-label>
            <input [(ngModel)]="focus.focusDetails.interlocutor.profession" name="profession" matInput />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Entreprise</mat-label>
            <input [(ngModel)]="focus.focusDetails.interlocutor.companyName" name="companyName" matInput />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Presentation</mat-label>
            <textarea matInput placeholder="Presentation" name="presentation"
              [(ngModel)]="focus.focusDetails.interlocutor.presentation" rows="5"></textarea>
          </mat-form-field>

        </form>
      </div>

    </div>
  </div>
</div>
